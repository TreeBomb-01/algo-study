# GPT-review: 개인정보 유효기간 (y,m,d 방식 코드 리뷰)

## 1) 핵심 요약
- y,m,d 직접 보정 방식은 경계 상황에서 오류가 발생하기 쉽습니다.
- 가장 큰 문제는 **월 정규화(12 초과/0 이하)**와 **하루 차감(d-1)** 처리의 결합입니다.
- 절대 일수 방식(`expire = collected + term*28 - 1`)이 단순하고 안전합니다.

---

## 2) 정확성을 깨뜨리는 주요 원인

### (A) 다중 월 넘침/부족 정규화 미흡
```python
m = m + term
if m > 12:
    m -= 12
    y += 1
elif m <= 0:
    m = 12
    y -= 1
```
- term이 12를 초과할 수 있음(최대 100).
- 위 코드는 월이 12를 여러 번 넘는 경우(예: m=30) 한 번만 조정 → 오정상화.

**개선 아이디어**
```python
y += (m - 1) // 12
m  = (m - 1) % 12 + 1
```

---

### (B) 하루 차감(d-1) + 월 차감 결합 취약
```python
d = int(dd) - 1
if d <= 0:
    d = 28
    m -= 1
```
- 1일에서 하루 빼면 월-1, 일이 28로 바뀌어야 하는데, 월=0일 때 재정규화가 필요.
- 현재 코드에는 빠져 있어 오류 가능.

---

## 3) 스타일/구현 아쉬운 점

### (C) terms 매핑 방식
```python
term_type.append(typ)
tbt.append(tb)
term = tbt[term_type.index(typ)]
```
- 리스트+index()는 비효율적이고 취약.
- 딕셔너리 사용 권장:
```python
term_months = {kind: int(months) for kind, months in ...}
term = term_months[typ]
```

### (D) 함수 역할 분리 부족
- `date()` 함수 안에서 파싱, 만료일 계산, 비교까지 한 번에 처리 → 테스트/디버깅 어려움.
- `to_days()`, `is_expired()` 등으로 쪼개는 게 좋음.

### (E) 네이밍/타입
- 불리언 반환 함수는 `is_expired` 같은 이름이 직관적.
- 타입 힌트를 추가하면 가독성 향상.

---

## 4) y,m,d 방식 최소 수정 가이드

1) term 더한 후 월 정규화:
```python
m += term
y += (m - 1) // 12
m  = (m - 1) % 12 + 1
```

2) 하루 차감 후 월 차감 처리:
```python
d -= 1
if d == 0:
    d = 28
    m -= 1
    if m == 0:
        m = 12
        y -= 1
```

---

## 5) 체크해야 할 엣지 케이스
- term이 12, 24, 36 … 등 배수일 때
- 시작일이 1일일 때
- 시작월이 12월이고 term이 커서 2년 이상 증가할 때

---

## 6) 결론
- 현재 코드의 주된 문제는 **월 정규화와 하루 차감 처리**.
- 최소 수정으로 보정할 수 있지만, 유지보수와 안정성을 위해서는 **절대 일수 방식**을 쓰는 것이 권장됩니다.
